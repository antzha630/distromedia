"use strict";(()=>{var e={};e.id=207;e.ids=[207];e.modules={3402:e=>{e.exports=require("@atproto/api")},3480:(e,t,r)=>{if(false){}else{if(false){}else{if(false){}else{e.exports=r(5600)}}}},4229:e=>{e.exports=require("node-fetch")},5558:(e,t,r)=>{r.r(t);r.d(t,{config:()=>d,"default":()=>c,routeModule:()=>f});var n={};r.r(n);r.d(n,{"default":()=>l});var s=r(3480);var a=r(8667);var o=r(6435);var i=r(3402);var u=r(4229);async function l(e,t){if(e.method!=="POST"){return t.status(405).json({error:"Method not allowed"})}const{text:r,accessJwt:n,did:s,embed:a}=e.body;if(!r||!n||!s){return t.status(400).json({error:"Missing required fields"})}const o=new i.BskyAgent({service:"https://bsky.social"});try{await o.resumeSession({accessJwt:n,did:s});let e=undefined;if(a?.external){const t={uri:a.external.uri,title:a.external.title,description:a.external.description||""};if(a.external.thumb){try{const e=await u(a.external.thumb);if(!e.ok)throw new Error("Failed to fetch image");const r=await e.buffer();const n=await o.uploadBlob(r,{encoding:"image/jpeg"});if(n?.data?.blob){t.thumb=n.data.blob}}catch(e){console.error("Failed to process image:",e)}}e={$type:"app.bsky.embed.external",external:t}}const i={text:r.trim(),embed:e};console.log("Posting to Bluesky with params:",JSON.stringify(i,null,2));const l=await o.post(i);t.status(200).json({success:true,response:l})}catch(e){console.error("Bluesky post failed:",e);t.status(500).json({success:false,error:e.message||"Post failed",details:e})}};const c=(0,o.M)(n,"default");const d=(0,o.M)(n,"config");const f=new s.PagesAPIRouteModule({definition:{kind:a.A.PAGES_API,page:"/api/bluesky/post",pathname:"/api/bluesky/post",bundlePath:"",filename:""},userland:n})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,t)=>{var r;r={value:true};Object.defineProperty(t,"M",{enumerable:true,get:function(){return n}});function n(e,t){if(t in e){return e[t]}if("then"in e&&typeof e.then==="function"){return e.then(e=>n(e,t))}if(typeof e==="function"&&t==="default"){return e}return undefined}},8667:(e,t)=>{var r;r={value:true};Object.defineProperty(t,"A",{enumerable:true,get:function(){return n}});var n=function(e){e["PAGES"]="PAGES";e["PAGES_API"]="PAGES_API";e["APP_PAGE"]="APP_PAGE";e["APP_ROUTE"]="APP_ROUTE";e["IMAGE"]="IMAGE";return e}({})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=e=>t(t.s=e);var n=r(5558);module.exports=n})();