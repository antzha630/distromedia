"use strict";(()=>{var e={};e.id=457;e.ids=[457];e.modules={3480:(e,n,r)=>{if(false){}else{if(false){}else{if(false){}else{e.exports=r(5600)}}}},4244:(e,n,r)=>{r.r(n);r.d(n,{config:()=>d,"default":()=>c,routeModule:()=>l});var t={};r.r(t);r.d(t,{"default":()=>s});var o=r(3480);var i=r(8667);var a=r(6435);async function s(e,n){const{code:r,state:t,error:o}=e.query;if(o){console.error("LinkedIn OAuth error:",o);return n.redirect(`/?error=${encodeURIComponent(o)}`)}const i=e.cookies.linkedin_oauth_state;if(!t||t!==i){console.error("Invalid OAuth state:",{received:t,saved:i});return n.redirect(`/?error=${encodeURIComponent("Invalid OAuth state")}`)}if(!r){return n.redirect(`/?error=${encodeURIComponent("No authorization code provided")}`)}try{const t=`${e.headers["x-forwarded-proto"]||"http"}://${e.headers.host}/api/linkedin/callback`;const o=await fetch("https://www.linkedin.com/oauth/v2/accessToken",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:r,client_id:process.env.LINKEDIN_CLIENT_ID,client_secret:process.env.LINKEDIN_CLIENT_SECRET,redirect_uri:t})});const i=await o.json();if(!o.ok){console.error("Token exchange failed:",i);throw new Error(i.error_description||"Failed to get access token")}const a=await fetch("https://api.linkedin.com/v2/userinfo",{headers:{"Authorization":`Bearer ${i.access_token}`}});const s=await a.json();if(!a.ok){console.error("Profile fetch failed:",s);throw new Error("Failed to get user profile")}let c="";try{const e=await fetch("https://api.linkedin.com/v2/me?projection=(profilePicture(displayImage~:playableStreams))",{headers:{"Authorization":`Bearer ${i.access_token}`}});const n=await e.json();const r=n.profilePicture&&n.profilePicture["displayImage~"]&&n.profilePicture["displayImage~"].elements;if(r&&r.length>0){const e=r[r.length-1];c=e.identifiers[0].identifier}console.log("LinkedIn /me response:",JSON.stringify(n,null,2))}catch(e){c=""}const d={accessToken:i.access_token,expiresIn:i.expires_in,userId:s.sub,name:s.name||`${s.given_name} ${s.family_name}`,email:s.email,profileImageUrl:c};console.log("Session being sent to frontend:",d);n.setHeader("Set-Cookie","linkedin_oauth_state=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT");n.redirect(`/?linkedin=${encodeURIComponent(JSON.stringify(d))}`);console.log("LinkedIn session:",d)}catch(e){console.error("LinkedIn callback error:",e);n.redirect(`/?error=${encodeURIComponent(e.message||"Authentication failed")}`)}};const c=(0,a.M)(t,"default");const d=(0,a.M)(t,"config");const l=new o.PagesAPIRouteModule({definition:{kind:i.A.PAGES_API,page:"/api/linkedin/callback",pathname:"/api/linkedin/callback",bundlePath:"",filename:""},userland:t})},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,n)=>{var r;r={value:true};Object.defineProperty(n,"M",{enumerable:true,get:function(){return t}});function t(e,n){if(n in e){return e[n]}if("then"in e&&typeof e.then==="function"){return e.then(e=>t(e,n))}if(typeof e==="function"&&n==="default"){return e}return undefined}},8667:(e,n)=>{var r;r={value:true};Object.defineProperty(n,"A",{enumerable:true,get:function(){return t}});var t=function(e){e["PAGES"]="PAGES";e["PAGES_API"]="PAGES_API";e["APP_PAGE"]="APP_PAGE";e["APP_ROUTE"]="APP_ROUTE";e["IMAGE"]="IMAGE";return e}({})}};var n=require("../../../webpack-api-runtime.js");n.C(e);var r=e=>n(n.s=e);var t=r(4244);module.exports=t})();